<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Душа Руси — Магазин футболок (3D Interactive)</title>
  <meta name="description" content="Душа Руси — бренд стильных футболок. WebGL, скролл-анимации и реакция на курсор."/>
  <meta name="theme-color" content="#d4af37"/>
  <link rel="manifest" href="/manifest.webmanifest"/>
  <link rel="icon" href="/icons/icon-192.png"/>
  <link rel="apple-touch-icon" href="/icons/icon-192.png"/>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@400;600;800&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { gold: '#d4af37', ink: '#121317', fog: '#a0a3ad' },
          fontFamily: { display: ['Unbounded','Inter','system-ui','sans-serif'], sans: ['Inter','system-ui','sans-serif'] },
          boxShadow: { glow: '0 0 40px rgba(212,175,55,0.25)' },
          backgroundImage: {
            'hero': 'radial-gradient(1000px 500px at 10% -10%, rgba(212,175,55,0.2), transparent), radial-gradient(800px 600px at 90% -20%, rgba(255,255,255,0.08), transparent)',
            'noise': 'url(data:image/svg+xml;utf8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"120\" height=\"120\"><filter id=\"n\"><feTurbulence type=\"fractalNoise\" baseFrequency=\"0.9\" numOctaves=\"2\" stitchTiles=\"stitch\"/></filter><rect width=\"100%\" height=\"100%\" filter=\"url(%23n)\" opacity=\"0.04\"/></svg>)'
          }
        }
      }
    }
  </script>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Three.js + GSAP -->
  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <script src="https://unpkg.com/gsap@3.12.5/dist/gsap.min.js"></script>
  <script src="https://unpkg.com/gsap@3.12.5/dist/ScrollTrigger.min.js"></script>

  <style>
    html, body { background: #121317; color: #e7e7ea }
    .gradient-border { position: relative; }
    .gradient-border:before {
      content: ""; position: absolute; inset: -1px; border-radius: 1.2rem;
      padding: 1px; background: linear-gradient(120deg, rgba(212,175,55,0.6), rgba(255,255,255,0.2));
      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor; mask-composite: exclude;
    }
  </style>
</head>
<body class="min-h-screen bg-ink bg-hero bg-noise bg-[length:100%_100%,auto]">
  <div id="root"></div>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => navigator.serviceWorker.register('/service-worker.js'));
    }
  </script>

  <script type="text/babel" data-presets="react">
    const { useEffect, useMemo, useRef, useState } = React;

    // --- Storage utils ---
    const LS_PRODUCTS = 'dusha_rusi_products';
    const LS_CART = 'dusha_rusi_cart';
    const money = (n) => new Intl.NumberFormat('ru-RU', { style: 'currency', currency: 'RUB', maximumFractionDigits: 0 }).format(n);
    const save = (k, v) => localStorage.setItem(k, JSON.stringify(v));
    const load = (k, d) => { try { return JSON.parse(localStorage.getItem(k)) ?? d; } catch { return d; } };

    const svgImage = (title = 'Душа Руси', color = '#0b0c10', accent = '#d4af37') => {
      const svg = \`
      <svg xmlns="http://www.w3.org/2000/svg" width="1200" height="900">
        <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="\${accent}" stop-opacity="0.2"/><stop offset="100%" stop-color="white" stop-opacity="0"/></linearGradient></defs>
        <rect width="100%" height="100%" fill="\${color}"/><rect width="100%" height="100%" fill="url(#g)"/>
        <g fill="none" stroke="\${accent}" stroke-width="6" opacity="0.35"><circle cx="980" cy="120" r="80"/><circle cx="1040" cy="180" r="40"/><path d="M0 820 C 200 760, 380 880, 640 820 S 1100 760, 1200 880"/></g>
        <text x="60" y="160" font-family="Unbounded, Arial, sans-serif" font-size="72" fill="\${accent}" opacity="0.9">Душа Руси</text>
        <text x="60" y="250" font-family="Inter, Arial, sans-serif" font-size="40" fill="white" opacity="0.88">\${title}</text>
      </svg>\`;
      return 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg);
    };

    const seedProducts = () => [
      { id: crypto.randomUUID(), title: 'Футболка «Золотой Витязь»', price: 2990, color: 'Чёрная', images: [svgImage('Золотой Витязь','#0b0c10')], description: 'Плотный хлопок 240 г/м², золотая тиснёная эмблема. Для тех, кто держит строй.', tags: ['унисекс','лимитированная'], published: true },
      { id: crypto.randomUUID(), title: 'Футболка «Северный Ветер»',   price: 2790, color: 'Белая',  images: [svgImage('Северный Ветер','#0f172a')], description: 'Чистые линии, холодный стиль. Дышащая ткань и идеальная посадка.', tags: ['унисекс'], published: true },
      { id: crypto.randomUUID(), title: 'Футболка «Пламя Степей»',     price: 2890, color: 'Бордовая', images: [svgImage('Пламя Степей','#220c10')], description: 'Насыщенный цвет и акцент на деталях. Для ярких характеров.', tags: ['унисекс','новинка'], published: true }
    ];

    const useProducts = () => {
      const [products, setProducts] = useState(() => load(LS_PRODUCTS, null) ?? (() => { const seeded = seedProducts(); save(LS_PRODUCTS, seeded); return seeded; })());
      useEffect(() => save(LS_PRODUCTS, products), [products]);
      return [products, setProducts];
    };

    const useCart = () => {
      const [cart, setCart] = useState(() => load(LS_CART, []));
      useEffect(() => save(LS_CART, cart), [cart]);
      const add = (p) => setCart(c => { const i = c.findIndex(x=>x.id===p.id); if (i>=0){ const copy=[...c]; copy[i].qty++; return copy; } return [...c,{ id:p.id, title:p.title, price:p.price, image:p.images?.[0], qty:1 }]; });
      const remove = (id) => setCart(c => c.filter(i => i.id !== id));
      const inc = (id) => setCart(c => c.map(i => i.id===id? {...i, qty:i.qty+1}: i));
      const dec = (id) => setCart(c => c.map(i => i.id===id? {...i, qty:Math.max(1,i.qty-1)}: i));
      const total = cart.reduce((s,i)=>s+i.price*i.qty,0);
      const clear = () => setCart([]);
      return { cart, add, remove, inc, dec, total, clear };
    };

    const Badge = ({children}) => <span className="inline-flex items-center text-xs uppercase tracking-wider px-2.5 py-1 rounded-full bg-white/5 border border-white/10 text-fog">{children}</span>;
    const Button = ({children, onClick, variant='primary', className=''}) => {
      const base = "relative isolate overflow-hidden group inline-flex items-center justify-center rounded-2xl px-5 py-3 text-sm font-semibold transition";
      const variants = { primary: "bg-gold/90 hover:bg-gold text-ink shadow-glow", ghost: "bg-white/5 hover:bg-white/10 border border-white/10 text-white", subtle: "bg-white/3 hover:bg-white/5 text-white" };
      return <button onClick={onClick} className={base + " " + variants[variant] + " " + className}>{children}</button>;
    };

    const IconCart = (props) => (
      <svg {...props} viewBox="0 0 24 24" fill="none" className={(props.className||'')+" stroke-current"} strokeWidth="1.6">
        <path d="M3 3h2l1.6 10.6a2 2 0 0 0 2 1.7h7.8a2 2 0 0 0 2-1.5l1.4-6.3H6.1" />
        <circle cx="9" cy="20" r="1.6" />
        <circle cx="18" cy="20" r="1.6" />
      </svg>
    );
    const IconAdmin = (props) => (
      <svg {...props} viewBox="0 0 24 24" fill="none" className={(props.className||'')+" stroke-current"} strokeWidth="1.6">
        <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-5 0-8 2.5-8 5v1h16v-1c0-2.5-3-5-8-5Z"/>
      </svg>
    );

    const Nav = ({ onGoAdmin, onGoHome, cartCount }) => (
      <nav className="sticky top-0 z-40 backdrop-blur supports-[backdrop-filter]:bg-ink/60 bg-ink/90 border-b border-white/10">
        <div className="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
          <div className="flex items-center gap-3">
            <img src="/icons/icon-192.png" className="w-8 h-8 rounded-full" alt="logo"/>
            <a onClick={onGoHome} className="cursor-pointer font-display text-xl font-extrabold tracking-wide">
              <span className="text-white">Душа </span><span className="text-gold">Руси</span>
            </a>
            <Badge>Футболки</Badge>
          </div>
          <div className="flex items-center gap-2">
            <Button variant="ghost" onClick={onGoAdmin} className="gap-2">
              <IconAdmin className="w-5 h-5"/><span>Админка</span>
            </Button>
            <Button variant="primary" onClick={()=>location.hash='#cart'} className="gap-2">
              <IconCart className="w-5 h-5"/><span>Корзина{cartCount?` • ${cartCount}`:''}</span>
            </Button>
          </div>
        </div>
      </nav>
    );

    // --- WebGL 3D Hero with GSAP sync ---
    const Hero3D = () => {
      const wrapRef = React.useRef(null);
      const overlayRef = React.useRef(null);
      const [enabled, setEnabled] = useState(true);
      const [ok, setOk] = useState(true);

      useEffect(() => {
        if (!enabled) return;
        if (!window.WebGLRenderingContext || !window.THREE) { setOk(false); return; }
        const mount = wrapRef.current;
        if (!mount) return;
        const rect = () => ({ w: mount.clientWidth, h: mount.clientHeight });

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true, powerPreference: 'high-performance' });
        const { w, h } = rect();
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.8));
        renderer.setSize(w, h);
        mount.appendChild(renderer.domElement);

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(45, w/h, 0.1, 100);
        camera.position.set(0, 0.2, 6);

        // Lights
        scene.add(new THREE.AmbientLight(0xffffff, 0.5));
        const key = new THREE.DirectionalLight(0xFFD700, 1.2); key.position.set(5, 5, 5); scene.add(key);
        const rim = new THREE.PointLight(0xffffff, 0.7); rim.position.set(-3, -2, 4); scene.add(rim);

        // Gold TorusKnot
        const geo = new THREE.TorusKnotGeometry(1.2, 0.32, 220, 35);
        const mat = new THREE.MeshStandardMaterial({ color: 0xC8A951, metalness: 0.9, roughness: 0.2, envMapIntensity: 1.0, emissive: 0x3a2a00, emissiveIntensity: 0.06 });
        const knot = new THREE.Mesh(geo, mat); scene.add(knot);

        // Particle halo
        const count = 1200;
        const pgeo = new THREE.BufferGeometry();
        const positions = new Float32Array(count*3);
        for (let i=0;i<count;i++){
          const r = 3 + Math.random()*1.7;
          const theta = Math.random()*Math.PI*2;
          const phi = Math.acos(2*Math.random()-1);
          positions[3*i]   = r*Math.sin(phi)*Math.cos(theta);
          positions[3*i+1] = r*Math.cos(phi)*0.5;
          positions[3*i+2] = r*Math.sin(phi)*Math.sin(theta);
        }
        pgeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        const pmaterial = new THREE.PointsMaterial({ color: 0xD4AF37, size: 0.02, transparent:true, opacity:0.75 });
        const points = new THREE.Points(pgeo, pmaterial);
        scene.add(points);

        // --- Cursor interaction (lerped target) ---
        let targetRotX = 0, targetRotY = 0;
        const onMove = (e) => {
          const b = mount.getBoundingClientRect();
          const x = (e.clientX - b.left) / b.width;
          const y = (e.clientY - b.top) / b.height;
          targetRotY = (x - 0.5) * 0.8;   // yaw
          targetRotX = (0.5 - y) * 0.5;   // pitch
        };
        mount.addEventListener('pointermove', onMove);

        // --- GSAP ScrollTrigger sync ---
        gsap.registerPlugin(ScrollTrigger);
        // Timeline: scale from 0.9 -> 1.15, rotate + glow, particles spread
        const tl = gsap.timeline({
          scrollTrigger: {
            trigger: mount,
            start: "top center",
            end: "bottom top",
            scrub: 1
          }
        });
        tl.to(knot.scale, { x: 1.15, y: 1.15, z: 1.15, ease: 'none' }, 0);
        tl.to(knot.rotation, { y: "+=1.2", ease: 'none' }, 0);
        tl.to(pmaterial, { opacity: 1.0, ease: 'none' }, 0);
        tl.to(camera.position, { z: 5.5, ease: 'none' }, 0);

        // Optional overlay fade (DOM synced with scroll)
        const overlay = overlayRef.current;
        if (overlay) {
          gsap.fromTo(overlay, { opacity: 0.0 }, {
            opacity: 0.15,
            scrollTrigger: { trigger: mount, start: "top center", end: "bottom top", scrub: 1 }
          });
        }

        // Animate
        let raf, t = 0;
        const animate = () => {
          raf = requestAnimationFrame(animate);
          t += 0.01;
          // Lerp towards target rotation (smooth)
          knot.rotation.x += (targetRotX - knot.rotation.x) * 0.08;
          knot.rotation.y += (targetRotY - knot.rotation.y) * 0.08;
          // Idle motion
          knot.rotation.z += 0.0025;
          points.rotation.y -= 0.0015;
          renderer.render(scene, camera);
        };
        animate();

        const onResize = () => {
          const w = mount.clientWidth, h = mount.clientHeight;
          renderer.setSize(w, h);
          camera.aspect = w/h; camera.updateProjectionMatrix();
        };
        const ro = new ResizeObserver(onResize);
        ro.observe(mount);

        return () => {
          mount.removeEventListener('pointermove', onMove);
          ScrollTrigger.getAll().forEach(t=>t.kill());
          cancelAnimationFrame(raf);
          ro.disconnect();
          renderer.dispose();
          while (mount.firstChild) mount.removeChild(mount.firstChild);
        };
      }, [enabled]);

      return (
        <div className="relative">
          <div className="aspect-[4/3] rounded-3xl gradient-border overflow-hidden shadow-glow">
            <div ref={wrapRef} className="w-full h-full"></div>
            <div ref={overlayRef} className="pointer-events-none absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-gold/10"></div>
            <div className="absolute top-3 right-3 z-10">
              <button onClick={()=>setEnabled(e=>!e)} className="px-3 py-1.5 rounded-xl bg-white/10 hover:bg-white/20 backdrop-blur border border-white/20 text-xs">
                3D: {enabled ? 'Вкл' : 'Выкл'}
              </button>
            </div>
          </div>
        </div>
      );
    };

    const Hero = () => (
      <section className="relative overflow-hidden">
        <div className="max-w-7xl mx-auto px-4 pt-14 pb-16 md:pt-18 md:pb-20">
          <div className="grid md:grid-cols-2 gap-10 items-center">
            <div>
              <div className="inline-flex items-center gap-2 mb-4">
                <span className="w-2 h-2 rounded-full bg-gold animate-pulse"></span>
                <span className="text-fog">Новая коллекция уже здесь</span>
              </div>
              <h1 className="font-display text-4xl md:text-6xl font-extrabold leading-tight">
                Красота. Характер. <span className="text-gold">Интерактив</span> в каждом кадре.
              </h1>
              <p className="mt-4 text-lg text-fog max-w-prose">
                WebGL + GSAP: реакция на курсор, скролл-анимации и плавный контроль камеры.
              </p>
              <div className="mt-6 flex gap-3">
                <Button onClick={()=>document.getElementById('catalog')?.scrollIntoView({behavior:'smooth'})}>Смотреть каталог</Button>
                <Button variant="ghost" onClick={()=>alert('О бренде: классика и современность в золотом сплаве.')}>
                  О бренде
                </Button>
              </div>
            </div>
            <Hero3D/>
          </div>
        </div>
      </section>
    );

    const ProductCard = ({p, onAdd}) => (
      <div className="group rounded-3xl bg-white/3 border border-white/10 overflow-hidden hover:shadow-glow transition">
        <div className="aspect-[4/3] overflow-hidden">
          <img src={p.images?.[0]} alt={p.title} className="w-full h-full object-cover group-hover:scale-[1.03] transition"/>
        </div>
        <div className="p-4 md:p-5">
          <div className="flex items-center justify-between gap-3">
            <h3 className="font-semibold text-lg md:text-xl">{p.title}</h3>
            <span className="text-gold font-semibold">{money(p.price)}</span>
          </div>
          <p className="mt-2 text-sm text-fog line-clamp-2">{p.description}</p>
          <div className="mt-4 flex items-center justify-between">
            <div className="flex gap-2">
              {p.tags?.map(t => <Badge key={t}>{t}</Badge>)}
            </div>
            <Button onClick={()=>onAdd(p)} className="px-4">В корзину</Button>
          </div>
        </div>
      </div>
    );

    const Catalog = ({ products, onAdd }) => (
      <section id="catalog" className="max-w-7xl mx-auto px-4 pb-16">
        <div className="flex items-end justify-between mb-4">
          <h2 className="font-display text-2xl md:text-3xl font-extrabold">Каталог</h2>
          <span className="text-fog">{products.length} позиций</span>
        </div>
        <div className="grid sm:grid-cols-2 lg:grid-cols-3 gap-5">
          {products.filter(p=>p.published).map(p => (
            <ProductCard key={p.id} p={p} onAdd={onAdd}/>
          ))}
        </div>
      </section>
    );

    const Cart = ({ cart, inc, dec, remove, total, clear }) => (
      <div className="max-w-4xl mx-auto px-4 py-10">
        <h2 className="font-display text-2xl md:text-3xl font-extrabold mb-6">Корзина</h2>
        {cart.length === 0 ? (
          <div className="text-fog">Пусто. Но это легко исправить 😉</div>
        ) : (
          <div className="space-y-4">
            {cart.map(i => (
              <div key={i.id} className="flex items-center gap-4 p-4 rounded-2xl bg-white/3 border border-white/10">
                <img src={i.image} alt={i.title} className="w-20 h-16 object-cover rounded-xl"/>
                <div className="flex-1">
                  <div className="font-semibold">{i.title}</div>
                  <div className="text-fog">{money(i.price)}</div>
                </div>
                <div className="flex items-center gap-2">
                  <button onClick={()=>dec(i.id)} className="w-8 h-8 rounded-lg bg-white/10">-</button>
                  <div className="w-8 text-center">{i.qty}</div>
                  <button onClick={()=>inc(i.id)} className="w-8 h-8 rounded-lg bg-white/10">+</button>
                </div>
                <button onClick={()=>remove(i.id)} className="ml-2 text-fog hover:text-white">Удалить</button>
              </div>
            ))}
            <div className="flex items-center justify-between pt-4 border-t border-white/10">
              <div className="text-fog">Итого</div>
              <div className="font-display text-2xl text-gold">{money(total)}</div>
            </div>
            <div className="flex gap-3">
              <Button variant="ghost" onClick={clear}>Очистить</Button>
              <Button onClick={()=>{ alert('Заказ создан! (демо)'); clear(); location.hash=''; }}>Оформить</Button>
            </div>
          </div>
        )}
      </div>
    );

    const Admin = ({ products, setProducts }) => {
      const [logged, setLogged] = useState(false);
      const [pwd, setPwd] = useState('');
      const [draft, setDraft] = useState({ title:'', price:2490, color:'', description:'', images:[], tags:'унисекс', published:true });
      const onLogin = () => { if (pwd === 'admin') setLogged(true); else alert('Неверный пароль. Подсказка: admin'); };
      const onImg = async (e) => {
        const files = Array.from(e.target.files || []);
        const readers = await Promise.all(files.map(f => new Promise(res=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.readAsDataURL(f);})));
        setDraft(d => ({...d, images:[...d.images, ...readers]}));
      };
      const add = () => {
        if (!draft.title) return alert('Название?');
        const p = { id: crypto.randomUUID(), title: draft.title, price: Number(draft.price||0), color: draft.color||'—', images: draft.images.length? draft.images : [svgImage(draft.title)], description: draft.description||'—', tags: draft.tags?.split(',').map(s=>s.trim()).filter(Boolean) ?? [], published: !!draft.published };
        setProducts(ps => [p, ...ps]); setDraft({ title:'', price:2490, color:'', description:'', images:[], tags:'унисекс', published:true }); alert('Добавлено!');
      };
      const del = (id) => setProducts(ps => ps.filter(x => x.id !== id));
      const toggle = (id) => setProducts(ps => ps.map(x => x.id===id ? {...x, published:!x.published} : x));

      if (!logged) return (
        <div className="max-w-sm mx-auto px-4 py-16">
          <h2 className="font-display text-3xl font-extrabold mb-4">Админка</h2>
          <div className="p-4 rounded-2xl bg-white/3 border border-white/10">
            <label className="text-sm text-fog">Пароль</label>
            <input type="password" value={pwd} onChange={e=>setPwd(e.target.value)} className="mt-2 w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2 outline-none"/>
            <Button className="mt-4 w-full" onClick={onLogin}>Войти</Button>
            <p className="mt-3 text-xs text-fog">Демо: пароль <b>admin</b></p>
          </div>
        </div>
      );

      return (
        <div className="max-w-6xl mx-auto px-4 py-10">
          <h2 className="font-display text-3xl font-extrabолd mb-6">Новый товар</h2>
          <div className="grid lg:grid-cols-3 gap-5">
            <div className="lg:col-span-1 p-4 rounded-2xl bg-white/3 border border-white/10">
              <div className="space-y-3">
                <div><label className="text-sm text-fog">Название</label><input value={draft.title} onChange={e=>setDraft(d=>({...d, title:e.target.value}))} className="mt-1 w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2 outline-none"/></div>
                <div className="grid grid-cols-2 gap-3">
                  <div><label className="text-sm text-fog">Цена</label><input type="number" value={draft.price} onChange={e=>setDraft(d=>({...d, price:e.target.value}))} className="mt-1 w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2 outline-none"/></div>
                  <div><label className="text-sm text-fog">Цвет</label><input value={draft.color} onChange={e=>setDraft(d=>({...d, color:e.target.value}))} className="mt-1 w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2 outline-none"/></div>
                </div>
                <div><label className="text-sm text-fog">Теги (через запятую)</label><input value={draft.tags} onChange={e=>setDraft(d=>({...d, tags:e.target.value}))} className="mt-1 w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2 outline-none"/></div>
                <div><label className="text-sm text-fog">Описание</label><textarea rows="4" value={draft.description} onChange={e=>setDraft(d=>({...d, description:e.target.value}))} className="mt-1 w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2 outline-none"></textarea></div>
                <div><label className="text-sm text-fog">Изображения</label><input type="file" accept="image/*" multiple onChange={onImg} className="mt-1 w-full rounded-xl bg-white/5 border border-white/10 px-3 py-2 outline-none"/>
                  <div className="mt-2 grid grid-cols-3 gap-2">{draft.images.map((src, idx)=>(<img key={idx} src={src} className="w-full h-20 object-cover rounded-lg"/>))}</div>
                </div>
                <div className="flex items-center gap-2"><input id="pub" type="checkbox" checked={draft.published} onChange={e=>setDraft(d=>({...d, published:e.target.checked}))}/><label htmlFor="pub" className="text-sm">Опубликовано</label></div>
                <Button onClick={add} className="w-full">Добавить</Button>
              </div>
            </div>
            <div className="lg:col-span-2">
              <h3 className="font-display text-xl font-extrabold mb-3">Товары</h3>
              <div className="grid sm:grid-cols-2 gap-4">
                {products.map(p => (
                  <div key={p.id} className="p-4 rounded-2xl bg-white/3 border border-white/10">
                    <div className="flex gap-3">
                      <img src={p.images?.[0]} className="w-28 h-24 object-cover rounded-xl"/>
                      <div className="flex-1">
                        <div className="font-semibold">{p.title}</div>
                        <div className="text-fog text-sm">{money(p.price)}</div>
                        <div className="mt-2 flex gap-2"><Badge>{p.published? 'опубликовано':'скрыто'}</Badge>{p.tags?.map(t=> <Badge key={t}>{t}</Badge>)}</div>
                      </div>
                    </div>
                    <div className="mt-3 flex gap-2"><Button variant="ghost" onClick={()=>toggle(p.id)}>Скрыть/Показать</Button><Button variant="ghost" onClick={()=>del(p.id)}>Удалить</Button></div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      );
    };

    const Footer = () => (
      <footer className="border-t border-white/10">
        <div className="max-w-7xl mx-auto px-4 py-8 flex flex-col md:flex-row items-center justify-between gap-4">
          <div className="text-fog">© 2025 «Душа Руси». Интерактив и стиль.</div>
          <div className="flex gap-3">
            <a className="text-fog hover:text-white" href="#" onClick={(e)=>{e.preventDefault(); alert('Пользовательское соглашение — демо.');}}>Условия</a>
            <span className="opacity-20">•</span>
            <a className="text-fog hover:text-white" href="#" onClick={(e)=>{e.preventDefault(); alert('Политика конфиденциальности — демо.');}}>Конфиденциальность</a>
          </div>
        </div>
      </footer>
    );

    const App = () => {
      const [products, setProducts] = useProducts();
      const cart = useCart();
      const [route, setRoute] = useState(() => location.hash.replace('#',''));
      useEffect(() => { const onHash = () => setRoute(location.hash.replace('#','')); window.addEventListener('hashchange', onHash); return () => window.removeEventListener('hashchange', onHash); }, []);

      return (
        <div className="pb-10">
          <Nav onGoAdmin={()=>location.hash='admin'} onGoHome={()=>{location.hash='';}} cartCount={cart.cart.length}/>
          {route === 'admin' ? <Admin products={products} setProducts={setProducts}/> :
           route === 'cart' ? <Cart {...cart}/> :
           <><Hero/><Catalog products={products} onAdd={cart.add}/></>}
          <Footer/>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App/>);
  </script>
</body>
</html>
